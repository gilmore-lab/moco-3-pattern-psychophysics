---
title: "summary-report"
author: "Rick O. Gilmore"
date: "`r Sys.Date()`"
output: 
  html_document:
    keep_md: true
    self_contained: true
  ioslides_presentation:
    css: css/gilmore.css
    incremental: false
    widescreen: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = FALSE)
```

```{r initialize}
# load libraries
require(nlme)
require(dplyr)
require(ggplot2)
require(knitr)

# load data
df <- read.csv(file = "analyses/data-aggregate/moco-beh-child.csv", header = TRUE)

# Source functions
fn.list <- list("analyses/summarize.bysub.bycond.R", 
                "analyses/plot.p.corr.R", 
                "analyses/plot.rt.R",
                "analyses/plot.p.corr.by.age.yrs.R")
lapply(fn.list, source, echo = FALSE, print.eval = FALSE)

# Summary data table to compute p(corr)
df.bysub.bycond <- summarize.bysub.bycond(df)

```

## Summary of participant ages, gender

```{r age-gender, echo=FALSE, include=TRUE}
# Summary table of age/gender dist
df.bysub.bycond %>% 
  group_by(Gender, AgeYrs, SubID) %>% 
  summarize(num = n()) -> df.gender.age
kable(xtabs(formula = ~ AgeYrs + Gender, data = df.gender.age))
```

## Plot of *p*(corr)

```{r p.corr.plot, include=TRUE}
# Plot p(corr)
p1 <- plot.p.corr(df.bysub.bycond)
p1
ggsave(plot = p1, filename = "analyses/img/p.corr.png")
```

## Plot of reaction time

```{r rt.plot, include=TRUE}
# Plot RTs
p2 <- plot.rt(df.bysub.bycond)
p2
ggsave(plot = p2, filename = "analyses/img/rt.png")
```

## Plot of *p*(corr) by age in years

```{r p.corr.by.age, include=TRUE}
# Plot p(corr) by age
p3 <- plot.p.corr.by.age.yrs(df.bysub.bycond)
p3
ggsave(plot = p3, filename = "analyses/img/p.corr.by.age.yrs.png")
```

## Linear mixed effects modeling of *p*(corr)

```{r anova.p.corr, include=TRUE}
# Simple mixed linear modeling
lme.p.corr <- lme( Pct.Corr ~ ordered(Coh)*PatternType*Speed, 
                   random = ~ 1 | SubID, 
                   data=df.bysub.bycond )
kable(anova(lme.p.corr))
```

## Evaluate Coherence x Speed interaction

```{r coh.by.spd.stats}
# Evaluate Speed by Coherence interaction
spd.by.coh <- df.bysub.bycond %>%
  group_by(Speed, Coh) %>%
  summarize(Pct.Corr.mean = mean(Pct.Corr, na.rm=TRUE),
            Pct.Corr.sem = sd(Pct.Corr, na.rm=TRUE)/sqrt( n() ))

limits = aes( ymax = Pct.Corr.mean + Pct.Corr.sem , ymin = Pct.Corr.mean - Pct.Corr.sem )

  theme.moco.plot <- theme(plot.title = element_text(size=18, face="bold"),
                           axis.title.x = element_text(size=18),
                           axis.title.y = element_text(size=18),
                           strip.text = element_text(size=16),
                           axis.text = element_text(size=12)
  )

p4 <- 
  ggplot( data=spd.by.coh, aes(x=Coh, y=Pct.Corr.mean) ) +
  facet_grid( facets = ~ Speed ) +
  geom_line() +
  geom_pointrange( limits ) +
  xlim(0,1) +
  ylim(.5, 1) +
  ylab("p(corr)") +
  xlab("p(coherence)") +
  theme(plot.title = element_text(size=18, face="bold"),
                           axis.title.x = element_text(size=18),
                           axis.title.y = element_text(size=18),
                           strip.text = element_text(size=16),
                           axis.text = element_text(size=14)
  )
```

```{r p.corr.by.spd.plot, include=TRUE}
p4
ggsave(plot = p4, filename = "analyses/img/p.corr.by.spd.png")
```

## Evaluate Coherence x Pattern interaction

```{r coh.by.pattern.stats}
# Evaluate PatternType x Coherence interaction
patt.by.coh <- df.bysub.bycond %>%
  group_by(PatternType, Coh) %>%
  summarize(Pct.Corr.mean = mean(Pct.Corr, na.rm=TRUE),
            Pct.Corr.sem = sd(Pct.Corr, na.rm=TRUE)/sqrt( n() ))

p5 <- 
  ggplot( data=patt.by.coh, aes(x=Coh, y=Pct.Corr.mean) ) +
  facet_grid( facets = ~ PatternType ) +
  geom_line() +
  geom_pointrange( limits ) +
  xlim(0, 1) +
  ylim(.5, 1) +
  ylab("p(corr)") +
  xlab("p(coherence)") +
  theme(plot.title = element_text(size=18, face="bold"),
                           axis.title.x = element_text(size=18),
                           axis.title.y = element_text(size=18),
                           strip.text = element_text(size=16),
                           axis.text = element_text(size=12)
  )
```

```{r coh.by.pattern.plot, include = TRUE}
p5
ggsave(plot = p5, filename = "analyses/img/p.corr.by.pattern.png")
```

## Observations about *p*(correct)

- Faster (8 deg/s) speed >> slower (2 deg/s)
- Radial >> Linear
